#!/bin/bash
#PBS -A TG-MCA94P014
#PBS -l size=12,walltime=00:0:10
#cd $PBS_O_WORKDIR
# uncomment this ^ for kraken
COMMAND=$1;
MPI=mpirun;
#MPI=${PETSC_DIR}/${PETSC_ARCH}/bin/mpiexec;
RUN="${MPI} -n 3"; 
DIR=./;
# for kraken, should be "time aprun -n 12"
# for valgrind, put valgrind after -n 2

GEO="-Nc 3 -Nx 25 -Ny 20 -Nz 7
-Npmlx 0 -Npmly 0 -Npmlz 2 -LowerPML 0
-hx 0.166666666666667 -hy 0.173205080756888 -hz 0.2 
-Mx 25 -My 20 -Mz 3 
-epsfile "../eps3d.txt" -fproffile "../fprof3d.txt"
-wa 1.7 -gamma 2.0";

PASSIVE="-wreal 1.725 -wimag -0.0 
-bx 1 -by -1 -bz 1
-kx 0 -ky 0 -kz 0
-BCPeriod 0 -norm 0.01
-passiveout pass3d
-nev 1";

CREEPER="-in0 pass3d
-out0 after
-dD 0.05 -Dmax 0.5
-newtonf_tol 1e-7 -thresholdw_tol 1e-7";

SOLVER="-printnewton 1";


if [[ $COMMAND = "passive" ]]; then
$RUN ${DIR}/SaltOut $GEO $PASSIVE -Dmax 0.0;
elif [[ $COMMAND = "salt" ]]; then
$RUN ${DIR}/SaltOut $GEO $CREEPER $SOLVER;
elif [[ $COMMAND = "test" ]]; then
mpirun -n 1 ${DIR}/TestOut;
fi
